# 目录挂载

**目录挂载**（Volume Mount）是指把**宿主机**（Host）上的目录或者文件，映射到**容器**（Container）内部的目录。这样容器就可以直接访问宿主机上的数据，甚至对其进行读写。

> [!NOTE] 为什么要挂载目录？
>
> 容器本身是 **临时的、易失的**，容器里的数据在容器删除后通常会丢失。所以通过目录挂载可以：
>
> - **持久化容器**：容器删除了，数据仍然存储在宿主机；
> - **共享数据**：多个容器之间可以访问同一份数据；
> - **调试和开发方便**：代码文件在宿主机修改了，容器内可以实时看到效果；



## 绑定挂载

绑定挂载（Bind Mount）是把宿主机的指定目录或文件直接挂到容器的某个目录。适合开发调试和共享宿主机已有的数据。

```bash {5}
# 启动时挂载目录
docker run -d \
	--name nginx \
	-p 80:80 \
	-v /app/mynginx:/usr/share/nginx/html/ \  # 把宿主机的 /app/mynginx 挂载到容器的 /usr/share/nginx/html/
	nginx:latest

# 向 /app/mynginx 目录下写入 index.html
cd /app/mynginx
echo Hello,World! > index.html
	
# 删除容器
docker rm -f nginx:latest

# TODO: 使用同样的命令，再次启动 nginx，可以发现 index.html 内的内容仍在
```



## 卷映射

卷映射是将外部目录映射到容器内部，容器删除后，如果没有删除卷，数据仍然保留。更适合生产环境的数据持久化。

> [!NOTE] 卷的存储路径
>
> 创建的卷由 Docker 管理，存储在 Docker 的默认路径 `/var/lib/docker/volumes/<volume name>` 下。

常用命令：

| 常用命令              | 作用           |
| --------------------- | -------------- |
| docker volume create  | 创建卷         |
| docker volume ls      | 列出卷         |
| docker volume inspect | 查看卷信息     |
| docker volume rm      | 删除卷         |
| docker volume prune   | 删除未使用的卷 |

> [!IMPORTANT] 提醒
>
> 绑定挂载和卷映射的不同之处在于：
>
> - 绑定挂载需要些完整路径，如 `/app/mynginx`；
> - 卷映射直接写 ngconf 即可，它表示的就是要创建卷的名称；

```bash {2}
# 启动镜像时创建卷映射（如果卷不存在，会直接创建）
docker run -d --name nginx -p 80:80 -v ngconf:/etc/nginx nginx:latest

# 查看所有卷
docker volume ls

# 查看 ngconf 卷的详细信息
docker volume inspect ngconf

# 查看卷下的数据
cd /var/lib/docker/volumes/ngconf/_data
ls

# 在卷中的 nginx.conf 中写入一些内容
vim nginx.conf

# 进入到容器内的 nginx 目录
docker exec -it nginx bash

# 查看 nginx.conf 文件，可以发现在卷中写入的内容，容器内同样存在
cat nginx.conf

# 删除 ngconf 卷
docker volume rm ngconf

# 删除未使用的卷
docker volume prune
```

