<script lang="ts" setup>
import { useData } from "vitepress"
import { computed, ref, onMounted } from "vue"
import { countWord } from "../utils/functions"

const { page } = useData()
const date = computed(() => new Date(page.value.lastUpdated!))

const wordCount = ref(0)
const imageCount = ref(0)

const wordTime = computed(() => {
  return (wordCount.value / 275) * 60
})

const imageTime = computed(() => {
  const n = imageCount.value
  if (imageCount.value <= 10) {
    // 等差数列求和
    return n * 13 + (n * (n - 1)) / 2
  }
  return 175 + (n - 10) * 3
})

// 阅读时间
const readTime = computed(() => {
  return Math.ceil((wordTime.value + imageTime.value) / 60)
})

function analyze() {
  document.querySelectorAll(".meta-des").forEach(v => v.remove())
  const docDomContainer = window.document.querySelector("#VPContent")
  const imgs = docDomContainer?.querySelectorAll<HTMLImageElement>(
    ".content-container .main img"
  )
  imageCount.value = imgs?.length || 0
  const words =
    docDomContainer?.querySelector(".content-container .main")?.textContent ||
    ""
  wordCount.value = countWord(words)
}

onMounted(() => {
  // 初始化时执行一次
  analyze()
})
</script>

<template>
  <div class="word">
    <p>
      <svg
        t="1747471543761"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="6901"
        width="16"
        height="16"
      >
        <path
          d="M716.6464 789.25824h35.83488c20.75136 0 37.71904-12.5696 37.71904-27.97568s-16.96768-27.97568-37.71904-27.97568h-35.83488c-20.75648 0-37.72416 12.5696-37.72416 27.97568 0.31744 15.40608 16.96768 27.97568 37.72416 27.97568zM716.6464 622.336h35.83488c20.75136 0 37.71904-12.5696 37.71904-27.97568 0-15.40096-16.96768-27.97568-37.71904-27.97568h-35.83488c-20.75648 0-37.72416 12.57472-37.72416 27.97568 0.31744 15.40608 16.96768 27.97568 37.72416 27.97568zM494.08 622.336h36.15232c20.74624 0 37.71904-12.5696 37.71904-27.97568 0-15.40096-16.9728-27.97568-37.71904-27.97568H494.08c-20.74624 0-37.71904 12.57472-37.71904 27.97568 0 15.40608 16.9728 27.97568 37.71904 27.97568zM271.51872 622.336h35.83488c20.75136 0 37.72928-12.5696 37.72928-27.97568 0-15.40096-16.97792-27.97568-37.72928-27.97568h-35.83488c-20.74624 0-37.72416 12.57472-37.72416 27.97568 0 15.40608 16.6656 27.97568 37.72416 27.97568zM494.08 789.25824h36.15232c20.74624 0 37.71904-12.5696 37.71904-27.97568s-16.9728-27.97568-37.71904-27.97568H494.08c-20.74624 0-37.71904 12.5696-37.71904 27.97568s16.9728 27.97568 37.71904 27.97568zM271.51872 789.25824h35.83488c20.75136 0 37.72928-12.5696 37.72928-27.97568s-16.97792-27.97568-37.72928-27.97568h-35.83488c-20.74624 0-37.72416 12.5696-37.72416 27.97568s16.6656 27.97568 37.72416 27.97568z"
          fill="#333333"
          p-id="6902"
        ></path>
        <path
          d="M793.344 176.58368h-56.26368V97.36704v-2.2016a27.38176 27.38176 0 0 0-27.35104-27.35104c-14.7712 0-27.03872 11.95008-27.35104 27.02848V176.896H344.13568V97.36704v-2.2016a27.37664 27.37664 0 0 0-27.34592-27.35104 27.0336 27.0336 0 0 0-27.0336 27.02848V176.896H230.656C140.11392 176.58368 66.56 240.08704 66.56 359.85408v430.6688c0 86.12864 65.38752 157.17376 148.3776 165.03296l578.4064 0.62464c90.53696 0 164.096-74.1888 164.096-165.6576V342.56384c0-91.47904-73.55904-165.98016-164.096-165.98016z m108.45696 630.28224c0 51.87072-44.94848 93.68064-99.96288 93.68064H222.48448c-55.32672 0-99.97312-42.12736-99.97312-93.68064V455.10656h779.60192l-0.31232 351.75936z m0-480.65024V399.4624H122.51136V326.21568c0-45.89568 40.2432-93.67552 111.2832-93.67552h55.9616V316.16c0.31744 14.45376 12.56448 26.40384 27.34592 26.40384a27.3664 27.3664 0 0 0 27.34592-27.35104V232.54016h338.24256V316.16c0.31744 14.45376 12.57472 26.40384 27.35616 26.40384a27.38176 27.38176 0 0 0 27.35104-27.35104V232.54016h53.12c55.0144 0 116.31104 40.54528 111.2832 93.67552z"
          fill="#333333"
          p-id="6903"
        ></path>
      </svg>
      <span class="word-item">更新: {{ date.toLocaleDateString() }}</span>

      <!-- <svg
        t="1724571760788"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="6125"
        width="16"
        height="16"
      >
        <path
          d="M204.8 0h477.866667l273.066666 273.066667v614.4c0 75.093333-61.44 136.533333-136.533333 136.533333H204.8c-75.093333 0-136.533333-61.44-136.533333-136.533333V136.533333C68.266667 61.44 129.706667 0 204.8 0z m307.2 607.573333l68.266667 191.146667c13.653333 27.306667 54.613333 27.306667 61.44 0l102.4-273.066667c6.826667-20.48 0-34.133333-20.48-40.96s-34.133333 0-40.96 13.653334l-68.266667 191.146666-68.266667-191.146666c-13.653333-27.306667-54.613333-27.306667-68.266666 0l-68.266667 191.146666-68.266667-191.146666c-6.826667-13.653333-27.306667-27.306667-47.786666-20.48s-27.306667 27.306667-20.48 47.786666l102.4 273.066667c13.653333 27.306667 54.613333 27.306667 61.44 0l75.093333-191.146667z"
          fill="#777777"
          p-id="6126"
        ></path>
        <path
          d="M682.666667 0l273.066666 273.066667h-204.8c-40.96 0-68.266667-27.306667-68.266666-68.266667V0z"
          fill="#E0E0E0"
          opacity=".619"
          p-id="6127"
        ></path>
      </svg> -->
      <svg
        t="1747472052971"
        class="icon"
        viewBox="0 0 1048 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="24789"
        width="16"
        height="16"
      >
        <path
          d="M310.598543 86.182563a200.962621 200.962621 0 0 0-200.962621 200.938241v430.595876a200.962621 200.962621 0 0 0 200.962621 200.987001h430.620256a200.962621 200.962621 0 0 0 200.962621-200.962621V287.096424a200.962621 200.962621 0 0 0-200.962621-200.962621H310.598543m0-86.158183h430.620256A287.096424 287.096424 0 0 1 1028.339603 287.120804v430.620256a287.096424 287.096424 0 0 1-287.096424 287.096424H310.598543A287.072044 287.072044 0 0 1 23.526499 717.74106V287.096424C23.526499 128.53026 152.056759 0.04876 310.598543 0.04876v-0.04876z"
          p-id="24790"
          data-spm-anchor-id="a313x.search_index.0.i10.42e13a816FhSq4"
          class=""
          fill="#333333"
        ></path>
        <path
          d="M489.009857 680.830056V360.942812h-141.402791a36.911004 36.911004 0 1 1-0.097519-73.846388H704.332175a36.911004 36.911004 0 1 1 0 73.846388h-141.402791v319.862864a36.911004 36.911004 0 1 1-73.822008 0h-0.07314z"
          p-id="24791"
          fill="#333333"
        ></path>
      </svg>
      <span class="word-item">字数: {{ wordCount }}字</span>

      <svg
        t="1724572797268"
        class="icon"
        viewBox="0 0 1060 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="15031"
        width="16"
        height="16"
      >
        <path
          d="M556.726857 0.256A493.933714 493.933714 0 0 0 121.929143 258.998857L0 135.021714v350.390857h344.649143L196.205714 334.482286a406.820571 406.820571 0 1 1-15.908571 312.649143H68.937143A505.819429 505.819429 0 1 0 556.726857 0.256z m-79.542857 269.531429v274.907428l249.197714 150.966857 42.422857-70.070857-212.114285-129.389714V269.787429h-79.542857z"
          fill="#333333"
          p-id="15032"
        ></path>
      </svg>
      <span class="word-item">时长: {{ readTime }}分钟</span>
    </p>
  </div>
</template>

<style>
.word {
  color: var(--vp-c-text-2);
  font-size: 15px;
}

.word .word-item {
  margin: 0 10px 0 4px;
}

.icon {
  display: inline-block;
  transform: translate(0px, 2px);
}
</style>
