# è‡ªåŠ¨è£…é…

è‡ªåŠ¨è£…é…å°±æ˜¯éµå¾ªçº¦å®šå¤§äºé…ç½®çš„åŸåˆ™ï¼Œåœ¨ boot ç¨‹åºå¯åŠ¨ä»¥åï¼Œèµ·æ­¥ä¾èµ–ä¸­çš„ä¸€äº› bean å¯¹è±¡ä¼šè‡ªåŠ¨æ³¨å…¥åˆ° IoC å®¹å™¨ä¸­ã€‚



## è‡ªåŠ¨è£…é…çš„åŸç†

> [!IMPORTANT] å¿…çœ‹
>
> è‡ªåŠ¨è£…é…çš„åŸç†ä¸€å®šè¦æ‡‚ï¼Œé¢è¯•å¿…é—®ç‚¹ï¼Œ[ğŸ”— è§†é¢‘è¯¾ç¨‹](https://www.bilibili.com/video/BV14z4y1N7pg?spm_id_from=333.788.videopod.episodes&vd_source=61f3a730a0daea9e6b7d510fb19007fd&p=11) è®²çš„å¾ˆé€å½»ã€‚

![è‡ªåŠ¨è£…é…åŸç†](./assets/è‡ªåŠ¨è£…é…åŸç†.jpg)

## è‡ªå®šä¹‰ starter

è‡ªåŠ¨è£…é…éœ€è¦ä¸¤ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼š

- `autoconfigure` æ¨¡å—ï¼šæä¾›è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œå¹¶è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ META-INF/spring/xxx.importsï¼›
- `starter` æ¨¡å—ï¼šåœ¨ starter ä¸­å¼•å…¥ `autoconfigure` æ¨¡å—æ¨¡å—ï¼›

> ä¸‹é¢æ¡ˆä¾‹æ¼”ç¤ºè‡ªå®šä¹‰ mybatis çš„ starterã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸¤ä¸ª Maven å·¥ç¨‹ï¼Œåˆ†åˆ«ä¸º ` dmybatis-spring-boot-autoconfigure ` å’Œ ` dmybatis-spring-boot-starter `ï¼ˆæ¨èéƒ½ä»¥è¿™ç§æ–¹å¼å‘½åï¼‰ã€‚

åœ¨ dmybatis-spring-boot-autoconfigure å·¥ç¨‹çš„ pom.xml ä¸­ï¼Œå¼•å…¥ mybatis ç›¸å…³çš„ä¾èµ–ï¼š

```xml
<dependencies>
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
    <version>3.5.3</version>
  </dependency>

  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
    <version>3.5.3</version>
  </dependency>

  <dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.16</version>
  </dependency>

  <dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>3.0.3</version>
  </dependency>
</dependencies>
```

ç„¶ååˆ›å»º `MybatisAutoConfig` é…ç½®ç±»ï¼Œåœ¨é…ç½®ç±»ä¸­æ³¨å…¥ `SqlSessionFactoryBean` å’Œ `MapperScannerConfigurer`ï¼š

```java
@AutoConfiguration // æ ‡è¯†å½“å‰ç±»æ˜¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»
public class MybatisAutoConfig {
  @Bean
  public SqlSessionFactoryBean sqlSessionFactory(DataSource dataSource) {
    SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
    sqlSessionFactoryBean.setDataSource(dataSource);
    return sqlSessionFactoryBean;
  }

  @Bean
  public MapperScannerConfigurer mapperScannerConfigurer(BeanFactory beanFactory) {
    MapperScannerConfigurer mapperScannerConfigurer = new MapperScannerConfigurer();
    // æ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…åŠå…¶å­åŒ…
    List<String> packages = AutoConfigurationPackages.get(beanFactory);
    String p = packages.getFirst();
    mapperScannerConfigurer.setBasePackage(p);
    // è®¾ç½®è¦æ‰«æçš„æ³¨è§£
    mapperScannerConfigurer.setAnnotationClass(Mapper.class);
    return  mapperScannerConfigurer;
  }
}
```

æœ€ååœ¨ resources ä¸‹ï¼Œæ–°å»º `META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports` æ–‡ä»¶ï¼Œå®ƒä¸“é—¨ç”¨äºå­˜å‚¨è¦è¢«è‡ªåŠ¨è£…é…çš„åŒ…ï¼š

::: info å°æç¤º

åœ¨åˆ›å»ºé…ç½®æ–‡ä»¶æ—¶ï¼Œåç§°å¿…é¡»ä¸ºä¸Šé¢æ‰€ç¤ºçš„åç§°ï¼Œå› ä¸ºè¿™æ˜¯æºç ä¸­å†™æ­»çš„ï¼Œä¸è¿™ä¹ˆå†™ä¼šæŠ¥é”™ï¼

:::

```txt
com.geomind.config.MybatisAutoConfig
```

------

æ¥ç€ï¼Œåœ¨ dmybatis-spring-boot-starter é¡¹ç›®çš„ pom.xml ä¸­ï¼Œå¼•å…¥ dmybatis-spring-boot-autoconfigure é…ç½®ç±»ï¼š

> [!TIP] å»ºè®®
>
> åœ¨ starter åŒ…ä¸­ï¼Œé™¤äº†å¼•å…¥ autoconfigure çš„åæ ‡ä»¥å¤–ï¼Œè¿˜éœ€è¦æŠŠ autoconfigure çš„ pom.xml ä¸­ä¾èµ–çš„åŒ…ä¹Ÿå¼•å…¥ä¸€ä¸‹ï¼ˆå®˜æ–¹æ¨èï¼‰ã€‚

```xml {2-6}
<dependencies>
  <dependency>
    <groupId>com.geomind</groupId>
    <artifactId>dmybatis-spring-boot-autoconfigure</artifactId>
    <version>1.0-SNAPSHOT</version>
  </dependency>

  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
    <version>3.5.3</version>
  </dependency>

  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
    <version>3.5.3</version>
  </dependency>

  <dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.16</version>
  </dependency>

  <dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>3.0.3</version>
  </dependency>
</dependencies>
```



ä¸Šè¿°é…ç½®å®Œæˆåï¼Œæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå¼•å…¥è‡ªå®šä¹‰çš„ dmybatis-spring-boot-starter åæ ‡ï¼Œå°±å¯ä»¥ä½¿ç”¨ mybatis çš„åŠŸèƒ½äº†ã€‚



